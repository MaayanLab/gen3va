{% extends 'wrapper.html' %}

{% block title %}{{ tag.name }}{% endblock %}

{% block body %}

    <script src="static/lib/highcharts/highcharts.js"></script>
    <script src="static/lib/highcharts/highcharts-3d.js"></script>
    <script src="static/lib/highcharts/highcharts-exporting.js"></script>

    <link href="https://cdn.datatables.net/1.10.10/css/dataTables.bootstrap.min.css" rel="stylesheet"/>
    <script src="https://cdn.datatables.net/1.10.10/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.10/js/dataTables.bootstrap.min.js"></script>

    <script src="static/js/report.js"></script>

    <div class="page" id="report-page">

        {% include 'partial/report-page-metadata.html' %}

        <!-- Gene signatures -->
        <div id="gene-signatures-table" class="section">
            <h4>Gene signatures</h4>
            <div class="download-link">
                <a href="{{ tag.name|c_download_url }}" target="_blank">Download genes signatures as TSV</a>
            </div>
            <div class="table-responsive">
                <table class="table data-table responsive">
                    <thead>
                        <tr>
                            <th></th>
                            <th>Results</th>
                            <th>Title</th>
                            <th>Organism</th>
                            <th>Platform</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for gene_signature in tag.gene_signatures %}
                            {% set dataset = gene_signature.soft_file.dataset %}
                            <tr>
                                <td class="index">{{ loop.index }}</td>
                                <td class="results" >
                                    <a href="{{ gene_signature.extraction_id|c_results_url }}" target="_blank">
                                        <i class="fa fa-file-o" data-toggle="tooltip" title="Results page for the processed gene signature."></i>
                                    </a>
                                </td>
                                <td class="title">
                                    {{ dataset.title|c_filter_empty|truncate(150) }}
                                </td>
                                <td class="organism">
                                    {{ dataset.organism|c_filter_empty }}
                                </td>
                                <td class="platform">{{ dataset.platform|c_filter_empty }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Principal Component Analysis -->
        <div class="section">
            <h4>PCA</h4>
            <p>Interactive 3D principal component analysis of gene signatures. You can rotate the visualization and mouse over the data points.</p>
            <div id="pca-container"></div>
        </div>

        <!-- Genes hierarchical clusterings -->
        <div class="section">
            <h4>Genes</h4>
            <p>Hierarchical clustering of genes based on weights from differential expression method.</p>
            <iframe src="{{ gene_hier_clust.link }}"></iframe>
        </div>

        <!-- Enrichr hierarchical clusterings -->
        <div id="enrichr-hier-clusts" class="section">
            <h4>Enrichr</h4>
            <div class="description">
                <span>Hierarchical clustering of enriched terms from</span>
                <select>
                    {% for library in enrichr_libraries %}
                        <option>{{ library }}</option>
                    {% endfor %}
                </select>
            </div>
            {% for clust in enrichr_links %}
                <iframe src="{{ clust.link }}" data-enrichr-library="{{ clust.enrichr_library }}"></iframe>
            {% endfor %}
        </div>

        <!-- L1000CD2 hierarchical clusterings -->
        <div class="section">
            <h4>L1000CDS2</h4>
            <p>Hierarchical clustering of perturbations that mimic (blue) and reverse (red) expression</p>
            <iframe src="{{ l1000cds_hier_clust.link }}"></iframe>
        </div>
    </div>

    <script>
        $(function () {
            plotPCA({{ pca_json|safe }});
        });
    </script>

{% endblock %}